version: 0.1
backend:
  phases:
    preBuild:
      commands:
        - 'cd packages/backend'
    build:
      commands:
        - if [ "${AWS_BRANCH}" = "main" ]; then envCache --set stackInfo ""; fi
        - if [ "${AWS_BRANCH}" = "main" ]; then amplifyPush --environment dev --simple; fi
        - if [ "${AWS_BRANCH}" = "test" ]; then envCache --set stackInfo ""; fi
        - if [ "${AWS_BRANCH}" = "test" ]; then amplifyPush --environment testenv --simple; fi
    postBuild:
      commands:
        - 'cd ../..'
frontend:
  phases:
    build:
      commands:
        - mkdir -p packages/frontend/dist
        - cp packages/frontend/src/* packages/frontend/dist/
  artifacts:
    baseDirectory: packages/frontend/dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules
      - packages/*/node_modules
